# http 缓存

## 说一下 http 缓存

### 强缓存

服务器开启强缓存，客户端会将第一次请求响应的资源、响应头中的 expires 字段保存在本地，其中 expires 字

段设置了强缓存资源的过期时间。当后续客户端再请求资源时，会对比本地时间与 expires 过期时间，如果过期，则需要

重新向服务器发起对资源的请求，否则直接使用本地保存的资源。

### 协商缓存

举个栗子，服务器开启协商缓存，客户端会将第一次请求响应的资源保存在本地，并将资源版本信息（E-Tag

= 111、Last-Modified-Since = 2018.6.3 ）保存在浏览器缓存表中，客户端第二次请求时会先请求浏览器缓存表

中的缓存信息，在请求头中加入字段（If-None-Match = 111、If-Modified-Since = 2018.6.3），服务器获取

之后比对 E-Tag、Last-Modified-Since 字段，若一致则返回 304 代码，客户端收到 304 后，直接使用本地缓存，否则返回新资源，客户端将新资源保存在本地，并将新 E-Tag = 112、Modified-Since = 2018.6.8 存入浏览器缓存表。

### no-store（禁所有缓存）

永远都不要在客户端存储资源，永远都去原始服务器去获取资源。

### no-cache（禁强缓存）

**可以在客户端存储资源**，每次都必须去服务端做新鲜度校验，来决定从服务端获取新的资源（200）还是使用客户端缓存（304）。也就是所谓的协商缓存。

使用 no-cache 的目的就是为了防止从缓存中获取过期的资源

---

一般情况下对于 index.html 或者现代构建环境下不加 hash 的静态资源都需要设置 Cache-Control: no-cache，用来强制每次在服务器端的新鲜度校验。

相当于

```
Cache-Control: max-age=0, must-revalidate
```
